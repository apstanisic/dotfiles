- name: ZSH
  tags:
    - zsh
  block:
    - name: Install zsh
      become: true
      # Curl and git is needed for zim
      apt:
        pkg:
          - curl
          - zsh
          - git

    - name: Change shell
      become: true
      # shell: usermod -s `which zsh` aleksandar
      user:
        name: aleksandar
        shell: /usr/bin/zsh
        state: present

    - name: Install plugin manager
      git:
        repo: 'https://github.com/marlonrichert/zsh-snap.git'
        dest: "{{ ansible_env.HOME }}/.znap/zsh-snap" 
        depth: 1

    - name: Install plugins
      shell: zsh $HOME/.dotfiles/scripts/update_zsh_plugins.zsh 

    - name: Link zshrc config
      shell: grep -qF 'if [ -e $HOME/.config/zsh/zshrc ]; then . $HOME/.config/zsh/zshrc; fi' ~/.zshrc || echo 'if [ -e $HOME/.config/zsh/zshrc ]; then . $HOME/.config/zsh/zshrc; fi' >> ~/.zshrc

    # Zimfw modifies .zshenv, so I simply inject my zshenv from different place, so zim does not dirty it
    # This injects config, only if file exists
    - name: Link zshenv config
      shell: grep -qF 'if [ -e $HOME/.config/zsh/zshenv ]; then . $HOME/.config/zsh/zshenv; fi' ~/.zshenv || echo 'if [ -e $HOME/.config/zsh/zshenv ]; then . $HOME/.config/zsh/zshenv; fi' >> ~/.zshenv
